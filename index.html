<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
  <title>Optimal Velocity Model</title>
  <style type="text/css">code{white-space: pre;}</style>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.21.1/axios.min.js"></script>
</head>
<body>
<h1 id="optimal-velocity-model">Optimal Velocity Model</h1>
<h2 id="simulator">Simulator</h2>
<canvas id="mycanvas" width="320" height="320"></canvas>
<div>
  <input type="button" onclick="restart()" value="Restart">
</div>
<h2 id="repository">Repository</h2>
<p><a href="https://github.com/kaityo256/ov_model" class="uri">https://github.com/kaityo256/ov_model</a></p>
<h2 id="reference">Reference</h2>
<ol style="list-style-type: decimal">
  <li>M. Bando, K. Hasebe, A. Nakayama, A. Shibata, and Y. Sugiyama, <a href="https://doi.org/10.1007/BF03167222">Jpn. J. Ind. Appl. Math. 11, 203 (1994)</a>.</li>
  <li>M. Bando, K. Hasebe, A. Nakayama, A. Shibata, and Y. Sugiyama, <a href="https://doi.org/10.1103/PhysRevE.51.1035">Phys. Rev. E 51, 1035 (1995)</a>.</li>
  <li>T. S. Komatsu, S. Sasa, <a href="https://doi.org/10.1103/PhysRevE.52.5574">Phys. Rev. E 52 5574 (1995)</a>.</li>
</ol>
<script>
let timer;

function draw_cars(x, y) {
  let canvas = document.getElementById('mycanvas');
  let ctx = canvas.getContext('2d');
  let size = canvas.height;
  let cx = size * 0.5;
  let cy = size * 0.5;
  let r = size * 0.4;
  let cr = size * 0.02;

  ctx.clearRect(0, 0, size, size);
  ctx.strokeStyle = "#000";
  ctx.beginPath();
  ctx.arc(cx, cy, r - cr, 0, Math.PI * 2, false);
  ctx.stroke();

  for (let i = 0; i < x.length; i++) {
    let px = x[i] * size;
    let py = y[i] * size;
    ctx.beginPath();
    ctx.arc(px, py, cr, 0, Math.PI * 2, false);
    ctx.stroke();
  }
}

function step() {
  axios.get('/step')
    .then(response => {
      draw_cars(response.data.x, response.data.y);
    })
    .catch(error => {
      console.error("There was an error with the simulation step!", error);
    });
}

function start() {
  stop();
  timer = setInterval(step, 50);
}

function stop() {
  clearInterval(timer);
}

function restart() {
  stop();
  start();
}

window.onload = function() {
  start();
}
</script>
</body>
</html>
